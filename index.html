<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dual Character Platformer</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
        }

        canvas {
            border: 4px solid #fff;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            background: #87CEEB;
        }

        .controls {
            margin-top: 20px;
            color: white;
            text-align: center;
            font-size: 18px;
            background: rgba(0,0,0,0.3);
            padding: 15px 30px;
            border-radius: 10px;
        }

        h1 {
            color: white;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <h1>Dual Character Platformer</h1>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div class="controls">
        JUMP: SPACE/W/UP ARROW | MOVE: A/D or LEFT/RIGHT ARROWS<br>
        Both characters must reach their flags AT THE SAME TIME!<br>
        ESC: Hard Reset (start over from Level 1)
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Game state
        let currentLevel = 0;
        let gameWon = false;
        let allLevelsComplete = false;
        let deathCount = 0;

        // Player 1 (Red)
        const player1 = {
            x: 50,
            y: 450,
            startX: 50,
            startY: 450,
            width: 30,
            height: 30,
            velocityY: 0,
            velocityX: 0,
            speed: 5,
            jumpPower: 12,
            grounded: false,
            color: '#FF6B6B',
            atGoal: false,
            dead: false
        };

        // Player 2 (Blue)
        const player2 = {
            x: 720,
            y: 450,
            startX: 720,
            startY: 450,
            width: 30,
            height: 30,
            velocityY: 0,
            velocityX: 0,
            speed: 5,
            jumpPower: 12,
            grounded: false,
            color: '#4ECDC4',
            atGoal: false,
            dead: false
        };

        // Level definitions
        const levels = [
            // LEVEL 1: Straight up - wide platforms, minimal movement
            {
                platforms: [
                    { x: 0, y: 570, width: 800, height: 30, color: '#2ECC71' },
                    // Wide platforms both sides
                    { x: 0, y: 480, width: 180, height: 20, color: '#27AE60' },
                    { x: 620, y: 480, width: 180, height: 20, color: '#27AE60' },
                    { x: 0, y: 390, width: 180, height: 20, color: '#27AE60' },
                    { x: 620, y: 390, width: 180, height: 20, color: '#27AE60' },
                    { x: 0, y: 300, width: 180, height: 20, color: '#27AE60' },
                    { x: 620, y: 300, width: 180, height: 20, color: '#27AE60' },
                    { x: 0, y: 210, width: 180, height: 20, color: '#27AE60' },
                    { x: 620, y: 210, width: 180, height: 20, color: '#27AE60' },
                ],
                spikes: [
                    { x: 250, y: 555, width: 300, height: 15 },
                    { x: 250, y: 465, width: 100, height: 15 },
                    { x: 450, y: 465, width: 100, height: 15 },
                ],
                movingPlatforms: [],
                goals: [
                    { x: 60, y: 160, width: 40, height: 50 },
                    { x: 700, y: 160, width: 40, height: 50 }
                ],
                player1Start: { x: 50, y: 450 },
                player2Start: { x: 720, y: 450 }
            },

            // LEVEL 2: Both move RIGHT together
            {
                platforms: [
                    { x: 0, y: 570, width: 800, height: 30, color: '#2ECC71' },
                    // Both characters move right across their sides
                    { x: 50, y: 470, width: 120, height: 20, color: '#27AE60' },
                    { x: 630, y: 470, width: 120, height: 20, color: '#27AE60' },
                    { x: 90, y: 370, width: 120, height: 20, color: '#27AE60' },
                    { x: 590, y: 370, width: 120, height: 20, color: '#27AE60' },
                    { x: 50, y: 270, width: 120, height: 20, color: '#27AE60' },
                    { x: 630, y: 270, width: 120, height: 20, color: '#27AE60' },
                    { x: 90, y: 170, width: 120, height: 20, color: '#27AE60' },
                    { x: 590, y: 170, width: 120, height: 20, color: '#27AE60' },
                ],
                spikes: [
                    { x: 250, y: 555, width: 300, height: 15 },
                    { x: 210, y: 455, width: 60, height: 15 },
                    { x: 530, y: 455, width: 60, height: 15 },
                    { x: 210, y: 255, width: 60, height: 15 },
                    { x: 530, y: 255, width: 60, height: 15 },
                ],
                movingPlatforms: [],
                goals: [
                    { x: 120, y: 120, width: 40, height: 50 },
                    { x: 640, y: 120, width: 40, height: 50 }
                ],
                player1Start: { x: 50, y: 450 },
                player2Start: { x: 720, y: 450 }
            },

            // LEVEL 3: Converge to center goals - both move RIGHT
            {
                platforms: [
                    { x: 0, y: 570, width: 800, height: 30, color: '#2ECC71' },
                    { x: 100, y: 470, width: 120, height: 20, color: '#27AE60' },
                    { x: 580, y: 470, width: 120, height: 20, color: '#27AE60' },
                    { x: 200, y: 370, width: 120, height: 20, color: '#27AE60' },
                    { x: 480, y: 370, width: 120, height: 20, color: '#27AE60' },
                    { x: 280, y: 270, width: 240, height: 20, color: '#27AE60' },
                    { x: 340, y: 170, width: 120, height: 20, color: '#27AE60' },
                ],
                spikes: [
                    { x: 220, y: 555, width: 360, height: 15 },
                    { x: 320, y: 455, width: 160, height: 15 },
                    { x: 240, y: 355, width: 60, height: 15 },
                    { x: 500, y: 355, width: 60, height: 15 },
                ],
                movingPlatforms: [],
                goals: [
                    { x: 360, y: 120, width: 40, height: 50 },
                    { x: 400, y: 120, width: 40, height: 50 }
                ],
                player1Start: { x: 50, y: 450 },
                player2Start: { x: 720, y: 450 }
            },

            // LEVEL 4: Synchronized jumps - vertical with moving platform
            {
                platforms: [
                    { x: 0, y: 570, width: 180, height: 30, color: '#2ECC71' },
                    { x: 620, y: 570, width: 180, height: 30, color: '#2ECC71' },
                    { x: 0, y: 420, width: 180, height: 20, color: '#27AE60' },
                    { x: 620, y: 420, width: 180, height: 20, color: '#27AE60' },
                    { x: 300, y: 300, width: 200, height: 20, color: '#27AE60' },
                    { x: 340, y: 180, width: 120, height: 20, color: '#27AE60' },
                ],
                spikes: [
                    { x: 180, y: 555, width: 440, height: 15 },
                    { x: 180, y: 405, width: 440, height: 15 },
                ],
                movingPlatforms: [
                    { x: 100, y: 510, width: 120, height: 15, startX: 100, endX: 500, speed: 2.5, direction: 1 },
                ],
                goals: [
                    { x: 360, y: 130, width: 40, height: 50 },
                    { x: 400, y: 130, width: 40, height: 50 }
                ],
                player1Start: { x: 50, y: 450 },
                player2Start: { x: 720, y: 450 }
            },

            // LEVEL 5: Right then up - both follow same path direction
            {
                platforms: [
                    { x: 0, y: 570, width: 800, height: 30, color: '#2ECC71' },
                    { x: 80, y: 470, width: 100, height: 20, color: '#27AE60' },
                    { x: 620, y: 470, width: 100, height: 20, color: '#27AE60' },
                    { x: 140, y: 370, width: 100, height: 20, color: '#27AE60' },
                    { x: 560, y: 370, width: 100, height: 20, color: '#27AE60' },
                    { x: 240, y: 290, width: 100, height: 20, color: '#27AE60' },
                    { x: 460, y: 290, width: 100, height: 20, color: '#27AE60' },
                    { x: 320, y: 210, width: 160, height: 20, color: '#27AE60' },
                    { x: 70, y: 140, width: 100, height: 20, color: '#27AE60' },
                    { x: 630, y: 140, width: 100, height: 20, color: '#27AE60' },
                ],
                spikes: [
                    { x: 250, y: 555, width: 300, height: 15 },
                    { x: 240, y: 455, width: 70, height: 15 },
                    { x: 490, y: 455, width: 70, height: 15 },
                    { x: 340, y: 355, width: 60, height: 15 },
                    { x: 400, y: 355, width: 60, height: 15 },
                    { x: 280, y: 275, width: 40, height: 15 },
                    { x: 480, y: 275, width: 40, height: 15 },
                ],
                movingPlatforms: [],
                goals: [
                    { x: 90, y: 90, width: 40, height: 50 },
                    { x: 670, y: 90, width: 40, height: 50 }
                ],
                player1Start: { x: 50, y: 450 },
                player2Start: { x: 720, y: 450 }
            },

            // LEVEL 6: Final - complex but symmetrical
            {
                platforms: [
                    { x: 0, y: 570, width: 800, height: 30, color: '#2ECC71' },
                    { x: 60, y: 460, width: 110, height: 20, color: '#27AE60' },
                    { x: 630, y: 460, width: 110, height: 20, color: '#27AE60' },
                    { x: 140, y: 360, width: 100, height: 20, color: '#27AE60' },
                    { x: 560, y: 360, width: 100, height: 20, color: '#27AE60' },
                    { x: 280, y: 280, width: 240, height: 20, color: '#27AE60' },
                    { x: 200, y: 180, width: 120, height: 20, color: '#27AE60' },
                    { x: 480, y: 180, width: 120, height: 20, color: '#27AE60' },
                    { x: 340, y: 90, width: 120, height: 20, color: '#27AE60' },
                ],
                spikes: [
                    { x: 200, y: 555, width: 400, height: 15 },
                    { x: 170, y: 445, width: 70, height: 15 },
                    { x: 560, y: 445, width: 70, height: 15 },
                    { x: 240, y: 345, width: 80, height: 15 },
                    { x: 480, y: 345, width: 80, height: 15 },
                    { x: 320, y: 265, width: 40, height: 15 },
                    { x: 440, y: 265, width: 40, height: 15 },
                    { x: 360, y: 165, width: 80, height: 15 },
                ],
                movingPlatforms: [
                    { x: 200, y: 510, width: 100, height: 15, startX: 200, endX: 500, speed: 2.5, direction: 1 },
                    { x: 100, y: 230, width: 80, height: 15, startX: 100, endX: 320, speed: 2, direction: 1 },
                    { x: 620, y: 230, width: 80, height: 15, startX: 480, endX: 700, speed: 2, direction: 1 },
                ],
                goals: [
                    { x: 360, y: 40, width: 40, height: 50 },
                    { x: 400, y: 40, width: 40, height: 50 }
                ],
                player1Start: { x: 50, y: 450 },
                player2Start: { x: 720, y: 450 }
            }
        ];

        let platforms = [];
        let spikes = [];
        let movingPlatforms = [];
        let goals = [];

        const gravity = 0.6;
        const keys = {};

        // Load level
        function loadLevel(levelIndex) {
            const level = levels[levelIndex];
            platforms = [...level.platforms];
            spikes = [...level.spikes];
            movingPlatforms = level.movingPlatforms.map(p => ({...p}));
            goals = [...level.goals];

            player1.x = level.player1Start.x;
            player1.y = level.player1Start.y;
            player1.startX = level.player1Start.x;
            player1.startY = level.player1Start.y;
            player1.velocityX = 0;
            player1.velocityY = 0;
            player1.atGoal = false;
            player1.dead = false;

            player2.x = level.player2Start.x;
            player2.y = level.player2Start.y;
            player2.startX = level.player2Start.x;
            player2.startY = level.player2Start.y;
            player2.velocityX = 0;
            player2.velocityY = 0;
            player2.atGoal = false;
            player2.dead = false;

            gameWon = false;
        }

        // Respawn player
        function respawnPlayer(player) {
            player.x = player.startX;
            player.y = player.startY;
            player.velocityX = 0;
            player.velocityY = 0;
            player.dead = false;
            player.atGoal = false;
            deathCount++;
        }

        // Keyboard input
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;

            // Jump with spacebar, arrow up, or W
            if (e.key === ' ' || e.key === 'Spacebar' || e.key === 'ArrowUp' || e.key === 'w' || e.key === 'W') {
                e.preventDefault();
                if (!player1.dead && player1.grounded) {
                    player1.velocityY = -player1.jumpPower;
                    player1.grounded = false;
                }
                if (!player2.dead && player2.grounded) {
                    player2.velocityY = -player2.jumpPower;
                    player2.grounded = false;
                }
            }

            // Next level
            if ((e.key === 'Enter') && gameWon && currentLevel < levels.length - 1) {
                currentLevel++;
                loadLevel(currentLevel);
            }

            // Restart game from level 1
            if (e.key === 'Enter' && allLevelsComplete) {
                currentLevel = 0;
                allLevelsComplete = false;
                deathCount = 0;
                loadLevel(currentLevel);
            }

            // Hard reset - restart entire game
            if (e.key === 'Escape') {
                currentLevel = 0;
                allLevelsComplete = false;
                gameWon = false;
                deathCount = 0;
                loadLevel(currentLevel);
            }
        });

        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        // Check collision
        function checkCollision(player, rect) {
            return player.x < rect.x + rect.width &&
                   player.x + player.width > rect.x &&
                   player.y < rect.y + rect.height &&
                   player.y + player.height > rect.y;
        }

        // Update player physics
        function updatePlayer(player) {
            if (player.dead || gameWon || allLevelsComplete) return;

            // Horizontal movement
            if (keys['ArrowLeft'] || keys['a'] || keys['A']) {
                player.velocityX = -player.speed;
            } else if (keys['ArrowRight'] || keys['d'] || keys['D']) {
                player.velocityX = player.speed;
            } else {
                player.velocityX = 0;
            }

            // Apply gravity
            player.velocityY += gravity;

            // Update position
            player.x += player.velocityX;
            player.y += player.velocityY;

            player.grounded = false;

            // Check platform collisions
            const allPlatforms = [...platforms, ...movingPlatforms];
            allPlatforms.forEach(platform => {
                if (checkCollision(player, platform)) {
                    if (player.velocityY > 0 && player.y + player.height - player.velocityY <= platform.y + 5) {
                        player.y = platform.y - player.height;
                        player.velocityY = 0;
                        player.grounded = true;
                    } else if (player.velocityY < 0 && player.y - player.velocityY >= platform.y + platform.height) {
                        player.y = platform.y + platform.height;
                        player.velocityY = 0;
                    } else if (player.velocityX > 0) {
                        player.x = platform.x - player.width;
                    } else if (player.velocityX < 0) {
                        player.x = platform.x + platform.width;
                    }
                }
            });

            // Screen boundaries
            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;

            // Death if fall off screen
            if (player.y > canvas.height) {
                player.dead = true;
                setTimeout(() => respawnPlayer(player), 500);
            }

            // Check spike collisions
            spikes.forEach(spike => {
                if (checkCollision(player, spike)) {
                    player.dead = true;
                    setTimeout(() => respawnPlayer(player), 500);
                }
            });

            // Check if at goal
            player.atGoal = false;
            goals.forEach((goal, index) => {
                const goalRect = { x: goal.x, y: goal.y, width: goal.width, height: goal.height };
                if (checkCollision(player, goalRect)) {
                    if ((index === 0 && player === player1) || (index === 1 && player === player2)) {
                        player.atGoal = true;
                    }
                }
            });

            // Win condition: BOTH must be at goal simultaneously
            if (player1.atGoal && player2.atGoal && !player1.dead && !player2.dead) {
                gameWon = true;
                if (currentLevel === levels.length - 1) {
                    allLevelsComplete = true;
                }
            }
        }

        // Update moving platforms
        function updateMovingPlatforms() {
            movingPlatforms.forEach(platform => {
                platform.x += platform.speed * platform.direction;

                if (platform.x >= platform.endX || platform.x <= platform.startX) {
                    platform.direction *= -1;
                }
            });
        }

        // Draw player
        function drawPlayer(player) {
            if (player.dead) {
                // Draw X for dead player
                ctx.strokeStyle = player.color;
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(player.x, player.y);
                ctx.lineTo(player.x + player.width, player.y + player.height);
                ctx.moveTo(player.x + player.width, player.y);
                ctx.lineTo(player.x, player.y + player.height);
                ctx.stroke();
                return;
            }

            // Shadow
            ctx.fillStyle = 'rgba(0,0,0,0.2)';
            ctx.fillRect(player.x + 5, player.y + player.height + 5, player.width, 5);

            // Body
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);

            // Eyes
            ctx.fillStyle = '#fff';
            ctx.fillRect(player.x + 8, player.y + 8, 6, 6);
            ctx.fillRect(player.x + 16, player.y + 8, 6, 6);

            ctx.fillStyle = '#000';
            ctx.fillRect(player.x + 10, player.y + 10, 3, 3);
            ctx.fillRect(player.x + 18, player.y + 10, 3, 3);

            // Indicator if at goal
            if (player.atGoal) {
                ctx.fillStyle = '#2ECC71';
                ctx.font = 'bold 40px Arial';
                ctx.fillText('âœ“', player.x - 5, player.y - 10);
            }
        }

        // Draw platform
        function drawPlatform(platform) {
            ctx.fillStyle = platform.color;
            ctx.fillRect(platform.x, platform.y, platform.width, platform.height);

            ctx.fillStyle = '#229954';
            for (let i = 0; i < platform.width; i += 10) {
                ctx.fillRect(platform.x + i, platform.y, 2, 5);
            }
        }

        // Draw moving platform
        function drawMovingPlatform(platform) {
            ctx.fillStyle = '#E67E22';
            ctx.fillRect(platform.x, platform.y, platform.width, platform.height);

            // Add pattern
            ctx.fillStyle = '#D35400';
            for (let i = 0; i < platform.width; i += 15) {
                ctx.fillRect(platform.x + i, platform.y, 2, platform.height);
            }
        }

        // Draw spike
        function drawSpike(spike) {
            ctx.fillStyle = '#E74C3C';
            const spikeCount = Math.floor(spike.width / 15);
            const spikeWidth = spike.width / spikeCount;

            for (let i = 0; i < spikeCount; i++) {
                ctx.beginPath();
                ctx.moveTo(spike.x + i * spikeWidth, spike.y + spike.height);
                ctx.lineTo(spike.x + i * spikeWidth + spikeWidth / 2, spike.y);
                ctx.lineTo(spike.x + (i + 1) * spikeWidth, spike.y + spike.height);
                ctx.fill();
            }

            // Outline
            ctx.strokeStyle = '#C0392B';
            ctx.lineWidth = 2;
            for (let i = 0; i < spikeCount; i++) {
                ctx.beginPath();
                ctx.moveTo(spike.x + i * spikeWidth, spike.y + spike.height);
                ctx.lineTo(spike.x + i * spikeWidth + spikeWidth / 2, spike.y);
                ctx.lineTo(spike.x + (i + 1) * spikeWidth, spike.y + spike.height);
                ctx.stroke();
            }
        }

        // Draw goal
        function drawGoal(goal, index) {
            // Pole
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(goal.x + 18, goal.y, 4, 50);

            // Flag color based on player
            const flagColor = index === 0 ? '#FF6B6B' : '#4ECDC4';
            ctx.fillStyle = flagColor;
            ctx.beginPath();
            ctx.moveTo(goal.x + 22, goal.y);
            ctx.lineTo(goal.x + 40, goal.y + 10);
            ctx.lineTo(goal.x + 22, goal.y + 20);
            ctx.fill();

            // Label
            ctx.fillStyle = '#000';
            ctx.font = 'bold 12px Arial';
            ctx.fillText(index === 0 ? 'P1' : 'P2', goal.x + 10, goal.y + 65);
        }

        // Game loop
        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Sky
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#E0F6FF');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Level indicator
            ctx.fillStyle = '#000';
            ctx.font = 'bold 24px Arial';
            ctx.fillText(`Level ${currentLevel + 1}/${levels.length}`, 20, 30);

            // Death count
            ctx.fillStyle = '#E74C3C';
            ctx.font = 'bold 20px Arial';
            ctx.fillText(`Deaths: ${deathCount}`, 20, 60);

            // Update game
            if (!gameWon && !allLevelsComplete) {
                updateMovingPlatforms();
                updatePlayer(player1);
                updatePlayer(player2);
            }

            // Draw everything
            platforms.forEach(drawPlatform);
            movingPlatforms.forEach(drawMovingPlatform);
            spikes.forEach(drawSpike);
            goals.forEach(drawGoal);
            drawPlayer(player1);
            drawPlayer(player2);

            // Level complete message
            if (gameWon && !allLevelsComplete) {
                ctx.fillStyle = 'rgba(0,0,0,0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.fillStyle = '#2ECC71';
                ctx.font = 'bold 50px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('LEVEL COMPLETE!', canvas.width / 2, canvas.height / 2 - 20);

                ctx.fillStyle = '#fff';
                ctx.font = '24px Arial';
                ctx.fillText('Press ENTER for next level', canvas.width / 2, canvas.height / 2 + 30);
                ctx.font = '18px Arial';
                ctx.fillText('Press ESC to restart from Level 1', canvas.width / 2, canvas.height / 2 + 60);
                ctx.textAlign = 'left';
            }

            // All levels complete
            if (allLevelsComplete) {
                ctx.fillStyle = 'rgba(0,0,0,0.8)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.fillStyle = '#FFD93D';
                ctx.font = 'bold 60px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('YOU WIN!', canvas.width / 2, canvas.height / 2 - 60);

                ctx.fillStyle = '#fff';
                ctx.font = '30px Arial';
                ctx.fillText('All levels complete!', canvas.width / 2, canvas.height / 2);

                ctx.fillStyle = '#E74C3C';
                ctx.font = 'bold 28px Arial';
                ctx.fillText(`Total Deaths: ${deathCount}`, canvas.width / 2, canvas.height / 2 + 40);

                ctx.fillStyle = '#fff';
                ctx.font = '20px Arial';
                ctx.fillText('Press ENTER to play again', canvas.width / 2, canvas.height / 2 + 75);
                ctx.textAlign = 'left';
            }

            requestAnimationFrame(gameLoop);
        }

        // Start game
        loadLevel(currentLevel);
        gameLoop();
    </script>
</body>
</html>
